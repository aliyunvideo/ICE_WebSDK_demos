<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://g.alicdn.com/thor-server/video-editing-websdk/4.12.2/player.css">
  <script src="https://g.alicdn.com/thor-server/video-editing-websdk/4.12.2/player.js"></script>
  <title>云剪预览播放器</title>
</head>

<body>
  <div id="root">

    <div id="player" style="width: 800px;height: 450px;"></div>
  </div>
  <script type="text/javascript">

    const timelineDemo = {
      "Version": 1,
      "SdkVersion": "4.12.2",
      "VideoTracks": [
        { // 视频轨道
          "Id": 1,
          "Type": "Video",
          "Visible": true,
          "Disabled": false,
          "Count": 1,
          "VideoTrackClips": [
            { // 图片
              "Id": 3,
              "TrackId": 1,
              "Type": "Image",
              "MediaURL": "https://img.alicdn.com/imgextra/i4/O1CN01TDN7Gw1SCgVv61T4s_!!6000000002211-0-tps-1920-1046.jpg",
              "Title": "test.png",
              "X": 0,
              "Y": 0,
              "Width": 1,
              "Height": 1,
              "TimelineIn": 0,
              "TimelineOut": 5,
              "Duration": 5,
              "VirginDuration": 5
            }, {
              // 视频
              "Id": 4,
              "TrackId": 1,
              "Type": "Video",
              "MediaURL": "https://ice-pub-media.myalicdn.com/vod-demo/%E6%9C%80%E7%BE%8E%E4%B8%AD%E5%9B%BD%E7%BA%AA%E5%BD%95%E7%89%87-%E6%99%BA%E8%83%BD%E5%AD%97%E5%B9%95.mp4",
              "X": 0,
              "Y": 0,
              "Width": 1,
              "Height": 1,
              "TimelineIn": 4, // 转场的入点(TimelineIn)需要在上一个片段出点(TimelineOut)以前
              "TimelineOut": 9,
              "Duration": 5,
              "VirginDuration": 5,
              "Effects": [
                { // 转场
                  "Type": "Transition",
                  "Id": 13,
                  "Name": "transitions.directional",
                  "SubType": "directional",
                  "Duration": 1, // 转场时长=上一个片段出点(TimelineOut)-这个片段的入点(TimelineIn)
                  "From": 3 // 上一个片段的ID
                }
              ]
            }
          ]
        },
        { // 特效轨道
          "Id": 2,
          "Type": "Effect",
          "Visible": true,
          "Disabled": false,
          "Count": 1,
          "VideoTrackClips": [
            {
              "Type": "VFX",
              "Id": 2,
              "TrackId": 1,
              "SubType": "heartfireworks",
              "TimelineIn": 0,
              "TimelineOut": 5,
              "Duration": 5,
              "X": 0,
              "Y": 0,
              "Width": 0,
              "Height": 0
            }
          ]
        }
      ],
      "AudioTracks": [],
      "SubtitleTracks": [
        {
          "Id": 2,
          "Type": "Text",
          "Visible": true,
          "Disabled": false,
          "Count": 1,
          "SubtitleTrackClips": [
            {
              "Id": 1,
              "TrackId": 2,
              "Type": "Text",
              "X": 0,
              "Y": 0,
              "TimelineIn": 0,
              "TimelineOut": 2,
              "Duration": 2,
              "VirginDuration": 2,
              "FontSize": 30,
              "FontColor": "#333333",
              "FontColorOpacity": 1,
              "Content": 'FontUrl自定义字体',
              "Alignment": "BottomCenter",
              // 自定义字体
              "FontUrl": "https://ice-pub-media.myalicdn.com/mts-fonts/%E7%AB%99%E9%85%B7%E6%96%87%E8%89%BA%E4%BD%93.ttf"
            }
          ]
        }
      ],
      "AspectRatio": "16:9",
      "From": "websdk",
      "FECanvas": {
        "Width": 800,
        "Height": 450
      },
      "FEConfig": {
        "AutoProportion": "681:383"
      }
    };
    // 前端解析Timeline数据
    const parsedData = window.AliyunTimelinePlayer.parseTimeline(timelineDemo,
      {
        outputWidth: timelineDemo.FECanvas.Width,
        outputHeight: timelineDemo.FECanvas.Height
      });

    console.log('PARSED DEATA', parsedData);

    const player = new window.AliyunTimelinePlayer({
      container: document.getElementById('player'),
      getMediaInfo: async (mediaId) => {
        const mediaMap = parsedData.mediaMap;
        if (mediaMap[mediaId]) {
          return mediaMap[mediaId].mediaUrl;
        }
        return '';
        // 如果使用mediaId，通过GetMediaInfo的方式获取数据，参考一下代码
        // return request('GetMediaInfo', { // https://help.aliyun.com/document_detail/197842.html
        //   MediaId: mediaId
        // }).then((res) => {
        //   // 注意，这里仅作为示例，实际中建议做好错误处理，避免如 FileInfoList 为空数组时报错等异常情况
        //   const fileInfoList = get(res, 'data.MediaInfo.FileInfoList', []);
        //   let mediaUrl, maskUrl;
        //   let sourceFile = fileInfoList.find((item) => {
        //     return item?.FileBasicInfo?.FileType === 'source_file';
        //   })
        //   if (!sourceFile) {
        //     sourceFile = fileInfoList[0]
        //   }
        //   const maskFile = fileInfoList.find((item) => {
        //     return (
        //       item.FileBasicInfo &&
        //       item.FileBasicInfo.FileUrl &&
        //       item.FileBasicInfo.FileUrl.indexOf('_mask') > 0
        //     );
        //   });
        //   if (maskFile) {
        //     maskUrl = get(maskFile, 'FileBasicInfo.FileUrl');
        //   }
        //   mediaUrl = get(sourceFile, 'FileBasicInfo.FileUrl');
        //   if (!maskUrl) {
        //     return mediaUrl;
        //   }
        //   return {
        //     url: mediaUrl,
        //     maskUrl
        //   }
        // })
      }
    });
    // 设置自定义字体
    player.setFontList(parsedData.fontList);
    // 预览前端Timeline，前端Timeline不能直接提交合成
    player.timeline = parsedData.timeline;
    // 可以通过toBackendTimeline转换为后端Timeline
    console.log('toBackendTimeline', parsedData.toBackendTimeline(parsedData.timeline));
  </script>
</body>

</html>